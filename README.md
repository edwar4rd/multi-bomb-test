# multi-bomb-test

簡單的傳炸彈小遊戲後端，練習寫 axum 跟 websocket 用。

## 遊戲說明

使用者界面分成 n 個區域，每個區域有一個中央的指示區域，跟左右各兩個按鈕。

```
(n=3)
+-------+-------+---------------+-------+-------+
|  < 3  |  < 1  |     >!!!<     |  1 >  |  2 >  |
+-------+-------+---------------+-------+-------+
|  < 3  |  < 1  |    BOMB >>    |  1 >  |  2 >  |
+-------+-------+---------------+-------+-------+
|  < 3  |  < 1  |    << BOMB    |  1 >  |  2 >  |
+-------+-------+---------------+-------+-------+
```

兩側的按鈕分別代表往左邊或往右邊傳一二或三個人，
中間則指示使用者炸彈在使用者的左邊或是右邊。

根據收到炸彈跟傳走炸彈之間的時間間隔使用者會得到分數，
並會在側邊的記分板顯示每個用戶的得分。

## Protocol

預設下，程式會在開啟後在 127.0.0.1:4568 接受 websocket 連線
使用者應該自行架設使用者代理

預設遊戲中有三顆炸彈，用戶端會在開啟連線之後收到一個文字訊息 HELLO = "hello " + count，
其中 count 為一個以十進位表示的 u32 數字，代表遊戲中炸彈的數量。

收到 HELLO 後，用戶端應該在可以準備開始遊戲後（如完成使用者界面的渲染），回應一個文字訊息 OLLEH = "olleh " + position, 
其中 position 為一個以十進位表示的 i32 數字，提示伺服器用戶端相對其他用戶的位置。
伺服器 MAY 根據這個數字決定用戶端與其他使用者的排序。

回應後伺服器會向用戶端發送一個 NAME 封包指明伺服器產生的使用者的名字與顏色，
一個 STATUS 封包其中包含每個炸彈相對於用戶端的位置，以及 BOARD 封包，包含記分板上使用者的狀況。
在這之後，用戶端也會收到不同的 STATUS 和 BOARD 封包，並應根據收到的封包改動畫面渲染的內容。

每個 NAME 封包包含兩行，
第一行是使用者的名字，
第二行是一個以十六進位表示的色碼(six-digit RGB notation)。
用戶端 MAY 在螢幕上使用這些資料來幫助使用者辨認自己的螢幕/記分板名字。

每個 STATUS 封包包含一個字母，代表炸彈與用戶端的相對位置
STATUS_BOMB = "X"
STATUS_LEFT = "L"
STATUS_RIGHT = "R"
STATUS = STATUS_BOMB | STATUS_LEFT | STATUS_RIGHT

每個 BOARD 封包包含數行以 "\n" 分隔的內容，
每三行構成一個記分板條目。
第一行為一個使用者名字，
第二行為一個以十六進位表示的色碼，
第三行為一個數字表示分數。
用戶端 MAY 使用這些資料來渲染一個記分板。

使用者在接到 STATUS_BOMB 封包後應該用最快的速度點下螢幕上的四個按鈕之一，
此時用戶端應該向使用者傳送一個 MOVE 封包。
用戶端 SHOULD 只在收到 STATUS_BOMB 之後才讓使用者點下按鈕或送出封包，
但伺服端 MUST 判斷用戶端的封包是否在適當的時間送出。

MOVE = "3L" | "1L" | "1R" | "2R"
代表把炸彈向左或右傳幾個使用者。
